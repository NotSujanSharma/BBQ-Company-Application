{% extends 'base.html' %}
{% block title %}My Bookings{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">
    <h2 class="text-3xl font-bold mb-8 text-center text-primary-400">Your Booked BBQ Events</h2>

    {% if messages %}
    <div class="mb-6">
        {% for message in messages %}
        <div class="bg-blue-900 border-l-4 border-blue-500 text-blue-200 p-4 mb-2" role="alert">
            <p class="font-bold">{{ message }}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if bookings %}
    <div class="overflow-x-auto bg-gray-800 rounded-lg shadow">
        <table class="min-w-full divide-y divide-gray-700">
            <thead class="bg-gray-700">
                <tr>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Date &
                        Time</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Event
                        Details</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Menu</th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Status
                    </th>
                    <th scope="col"
                        class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Actions
                    </th>
                </tr>
            </thead>
            <tbody class="bg-gray-800 divide-y divide-gray-700">
                {% for booking in bookings %}
                <tr>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-300">{{ booking.date }}</div>
                        <div class="text-sm text-gray-400">{{ booking.time }}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm text-gray-300">{{ booking.get_event_type_display }}</div>
                        <div class="text-sm text-gray-400">{{ booking.location }}</div>
                        <div class="text-sm text-gray-400">Guests: {{ booking.guests }}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-300">
                            <strong class="text-primary-400">Main Dishes:</strong>
                            {% for dish, count in booking.main_dishes.items %}
                            <span
                                class="inline-block bg-gray-700 rounded-full px-2 py-1 text-xs font-semibold text-gray-300 mr-1 mb-1">
                                {{dish }}: {{ count }}</span>
                            {% endfor %}
                        </div>
                        <div class="text-sm text-gray-300 mt-2">
                            <strong class="text-primary-400">Side Dishes:</strong>
                            {% for dish, count in booking.side_dishes.items %}
                            <span
                                class="inline-block bg-gray-700 rounded-full px-2 py-1 text-xs font-semibold text-gray-300 mr-1 mb-1">
                                {{dish }}: {{ count }}</span>
                            {% endfor %}
                        </div>
                        <div class="text-sm text-gray-300 mt-2">
                            <strong class="text-primary-400">Desserts:</strong>
                            {% for dish, count in booking.desserts.items %}
                            <span
                                class="inline-block bg-gray-700 rounded-full px-2 py-1 text-xs font-semibold text-gray-300 mr-1 mb-1">
                                {{dish }}: {{ count }}</span>
                            {% endfor %}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                            {% if booking.status == 0 %} bg-yellow-200 text-yellow-800
                            {% elif booking.status == 1 %}bg-green-200 text-green-800
                            {% elif booking.status == 2 %}bg-red-200 text-red-800
                            {% else %} bg-blue-200 text-blue-800 {% endif %}">

                            {%if booking.status == 0 %}
                            
                            pending
                            
                            {%elif booking.status == 1 %}
                            
                           Confirmed
                            
                            {%elif booking.status == 2 %}
                            
                            Cancelled
                            
                            {%else%}
                            
                            Completed
                            
                            {%endif%}

                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <a href="{% url 'edit_booking' booking.id %}"
                            class="text-primary-400 hover:text-primary-300 mr-2">Edit</a>
                        <form action="{% url 'delete_booking' booking.id %}" method="post" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-red-400 hover:text-red-300 mr-2"
                                onclick="return confirm('Are you sure you want to delete this booking?');">Delete</button>
                        </form>
                        <form action="{% url 'cancel_booking' booking.id %}" method="post" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="text-yellow-400 hover:text-yellow-300"
                                onclick="return confirm('Are you sure you want to cancel this booking?');">Cancel</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-center text-gray-400 mt-8">You haven't booked any BBQ events yet.</p>
    {% endif %}

    <div class="mt-8 text-center">
        <a href="{% url 'book_bbq' %}"
            class="bg-primary-600 hover:bg-primary-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
            Book a new BBQ event
        </a>
    </div>
</div>
{% endblock %}